!function(t){function e(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,e,n){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=9)}([function(t,e){t.exports=Vue},function(t,e,n){"use strict";(function(t,o){function a(t,e){this._id=t,this._clearFn=e}var i=n(6).nextTick,r=Function.prototype.apply,s=Array.prototype.slice,u={},c=0;e.setTimeout=function(){return new a(r.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new a(r.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},e.setImmediate="function"==typeof t?t:function(t){var n=c++,o=!(arguments.length<2)&&s.call(arguments,1);return u[n]=!0,i(function(){u[n]&&(o?t.apply(null,o):t.call(null),e.clearImmediate(n))}),n},e.clearImmediate="function"==typeof o?o:function(t){delete u[t]}}).call(e,n(1).setImmediate,n(1).clearImmediate)},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function a(t){return t.toLocaleString("fi",{style:"currency",currency:"EUR"})}function i(t){return t.toFixed(2)+" €"}function r(t,e,n){return new d.default(function(o,a){var i=new XMLHttpRequest;i.onload=function(){i.status>=200&&i.status<300?o(JSON.parse(i.responseText)):i.onerror()},i.onerror=function(){a(i.responseText?JSON.parse(i.responseText):null)},i.open(t,e),i.setRequestHeader("Accept","application/json"),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(n?JSON.stringify(n):null)})}Object.defineProperty(e,"__esModule",{value:!0}),e.loadingOverlay=e.storeMessages=e.storeFormGroup=e.storeXHR=e.formatPrice=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=n(0),c=o(u),l=n(7),d=o(l),f=!("object"!==("undefined"==typeof Intl?"undefined":s(Intl))||!Intl||"function"!=typeof Intl.NumberFormat),p=void 0;f?e.formatPrice=p=a:e.formatPrice=p=i;var m=c.default.component("store-form-group",{props:{title:String,field:String,messages:Object,update:Function,data:Object},methods:{onInput:function(t){this.$emit("update",this.field,t)}},computed:{clazz:function(){var t=this.messages,e=this.field;return t&&t[e]&&t[e].length>0?"form-group has-error":"form-group"}},template:'<div v-bind:class="clazz">\n        <label class="col-sm-4 control-label">{{ title }}</label>\n        <div class="col-sm-8">\n            <input class="form-control" @input="onInput" v-bind:value="data[field]" />\n            <store-messages :field="field" :messages="messages" />\n        </div>\n    </div>'}),v=c.default.component("store-messages",{props:{field:String,messages:Object},computed:{localMessages:function(){var t=this.messages,e=this.field;return t&&t[e]&&t[e].length>0?t[e]:null}},template:'<div><p v-if="localMessages">\n        <div class="alert alert-danger" role="alert" v-for="message in localMessages">\n            <span class="fa fa-times"></span> {{ message }}\n        </div>\n    </p></div>'}),h=c.default.component("loading-overlay",{props:{loading:Boolean,text:String},computed:{clazz:function(){return this.loading?"loading-overlay loading-overlay-active":"loading-overlay"}},template:'<div v-bind:class="clazz">\n        <div class="fa fa-spinner fa-pulse fa-3x fa-fw"></div>\n        <div v-if="text">{{ text }}</div>\n    </div>'});e.formatPrice=p,e.storeXHR=r,e.storeFormGroup=m,e.storeMessages=v,e.loadingOverlay=h},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var a=n(0),i=o(a);i.default.component("store-information-form",{template:n(8),props:{messages:Object,data:Object},methods:{update:function(t,e){this.data[t]=e.target.value}}})},function(t,e){t.exports='<div>\n    <h3>Tuotteet</h3>\n    <div class="list-unstyled store-items loading-container">\n        <store-product v-for="product in products" :product="product" :cart="cart" :messages="messages" v-on:addItem="addItem" />\n        <loading-overlay :loading="loadingStatus === \'loading\'" />\n        <div v-if="loadingStatus === \'error\'" class="alert alert-danger">\n            Virhe tuotelistaa hakiessa.\n        </div>\n    </div>\n    <h3>Ostoskori</h3>\n    <store-messages field="items" :messages="messages" />\n    <div class="list-unstyled store-items">\n        <div v-for="item in cart">\n            <div class="pull-left">\n                <span>{{ item.product.name }}</span>\n                <span v-if="item.variant">({{ item.variant.name }})</span>\n            </div>\n            <span class="pull-right">\n            x {{ item.count }} = {{ getSubtotal(item) | formatPrice }}\n            <button class="btn btn-secondary" v-on:click="changeItemCount(item, 1)">+</button>\n            <button class="btn btn-secondary" v-on:click="changeItemCount(item, -1)">-</button>\n            <button class="btn btn-danger" v-on:click="removeItemFromCart(item)">\n                <span class="fa fa-fw fa-trash"></span>\n            </button>\n            </span>\n            <span class="clearfix"></span>\n        </div>\n        <div>Yhteensä: {{ totalPrice | formatPrice }}</div>\n    </div>\n    <h3>Tiedot</h3>\n    <store-information-form @infoUpdate="updateInfo" :data="info" :messages="messages" />\n    <h3>Maksutapa</h3>\n    <div class="form-group">\n        <label class="col-sm-4">Maksutapa</label>\n        <div class="col-sm-8">\n            <select v-model="paymentMethod">\n                <option v-for="method in paymentMethods" v-bind:value="method.id">\n                    {{ method.name }}\n                </option>\n            </select>\n        </div>\n    </div>\n    <span class="pull-right">\n    <button class="btn btn-primary" @click="submit">Jatka &gt;</button>\n</span>\n</div>'},function(t,e){t.exports='<div class="product form">\n    <span class="pull-right form-inline">\n        <span class="product-cart-count" v-if="cartCount > 0">\n            <span class="fa fa-shopping-cart"></span> {{ cartCount }}\n        </span>\n        <select class="form-control product-variants" v-if="product.variants && product.variants.length > 0" v-model="variant">\n            <option v-for="variant in product.variants" v-bind:value="variant">\n                {{ variant.name }}\n            </option>\n        </select>\n        <button class="btn btn-success" v-on:click="addItem()">\n            <span class="fa fa-plus" /> Lisää\n        </button>\n    </span>\n    <div>\n        <img :src="product.imagefile_thumbnail_url" width="48" height="48" />\n        {{ product.name }} ({{ product.price | formatPrice }})\n        <p class="small" v-if="product.description" v-html="product.description"></p>\n        <p v-if="product.discount_amount > 0">\n            <span class="fa fa-info"/>\n            {{ product.discount_percentage }} % alennus, jos ostat ainakin {{ product.discount_amount }} kappaletta!\n        </p>\n    </div>\n    <span class="clearfix"></span>\n</div>'},function(t,e){"use strict";function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(t){if(l===setTimeout)return setTimeout(t,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(t,0);try{return l(t,0)}catch(e){try{return l.call(null,t,0)}catch(e){return l.call(this,t,0)}}}function i(t){if(d===clearTimeout)return clearTimeout(t);if((d===o||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function r(){v&&p&&(v=!1,p.length?m=p.concat(m):h=-1,m.length&&s())}function s(){if(!v){var t=a(r);v=!0;for(var e=m.length;e;){for(p=m,m=[];++h<e;)p&&p[h].run();h=-1,e=m.length}p=null,v=!1,i(t)}}function u(t,e){this.fun=t,this.array=e}function c(){}var l,d,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(t){l=n}try{d="function"==typeof clearTimeout?clearTimeout:o}catch(t){d=o}}();var p,m=[],v=!1,h=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];m.push(new u(t,e)),1!==m.length||v||a(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,n){"use strict";(function(e){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(o){function a(){}function i(t,e){return function(){t.apply(e,arguments)}}function r(t){if("object"!==n(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function s(t,e){for(;3===t._state;)t=t._value;return 0===t._state?void t._deferreds.push(e):(t._handled=!0,void r._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null===n)return void(1===t._state?u:c)(e.promise,t._value);var o;try{o=n(t._value)}catch(t){return void c(e.promise,t)}u(e.promise,o)}))}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===("undefined"==typeof e?"undefined":n(e))||"function"==typeof e)){var o=e.then;if(e instanceof r)return t._state=3,t._value=e,void l(t);if("function"==typeof o)return void f(i(o,e),t)}t._state=1,t._value=e,l(t)}catch(e){c(t,e)}}function c(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&r._immediateFn(function(){t._handled||r._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)s(t,t._deferreds[e]);t._deferreds=null}function d(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,u(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}var p=setTimeout;r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){var n=new this.constructor(a);return s(this,new d(t,e,n)),n},r.all=function(t){var e=Array.prototype.slice.call(t);return new r(function(t,o){function a(r,s){try{if(s&&("object"===("undefined"==typeof s?"undefined":n(s))||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(t){a(r,t)},o)}e[r]=s,0===--i&&t(e)}catch(t){o(t)}}if(0===e.length)return t([]);for(var i=e.length,r=0;r<e.length;r++)a(r,e[r])})},r.resolve=function(t){return t&&"object"===("undefined"==typeof t?"undefined":n(t))&&t.constructor===r?t:new r(function(e){e(t)})},r.reject=function(t){return new r(function(e,n){n(t)})},r.race=function(t){return new r(function(e,n){for(var o=0,a=t.length;o<a;o++)t[o].then(e,n)})},r._immediateFn="function"==typeof e&&function(t){e(t)}||function(t){p(t,0)},r._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},r._setImmediateFn=function(t){r._immediateFn=t},r._setUnhandledRejectionFn=function(t){r._unhandledRejectionFn=t},"undefined"!=typeof t&&t.exports?t.exports=r:o.Promise||(o.Promise=r)}(void 0)}).call(e,n(1).setImmediate)},function(t,e){t.exports='<form class="form-horizontal" @submit.prevent>\n    <p>Huomaathan, että lippukoodit lähetetään annettuun sähköpostiosoitteeseen.</p>\n    <div class="row"><div class="col-lg-6">\n        <store-form-group title="Etunimi" field="first_name" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Sukunimi" field="last_name" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Sähköposti" field="email" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Vahvista sähköposti" field="email2" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Matkapuhelin" field="mobile" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Muu puhelinnumero" field="telephone" @update="update" :messages="messages" :data="data" />\n    </div>\n    <div class="col-lg-6">\n        <store-form-group title="Katuosoite" field="street" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Postinumero" field="postal_code" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Kaupunki" field="city" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Maa" field="country" @update="update" :messages="messages" :data="data" />\n        <store-form-group title="Yritys" field="company" @update="update" :messages="messages" :data="data" />\n    </div></div>\n    <div class="form-group">\n        <label class="col-lg-2 control-label">Lisätietoja</label>\n        <div class="col-lg-10">\n            <textarea class="form-control" @input="update(\'information\', $event)" v-bind:value="data.information"></textarea>\n            <store-messages field="information" :messages="messages" />\n        </div>\n    </div>\n    <div class="form-group">\n        <div class="col-sm-12">\n            <label class="control-label">\n                <input type="checkbox" v-model="data.read_terms" />\n                <span>\n                    Olen lukenut <a target="_blank" href="/store/terms">toimitusehdot</a> sekä <a target="_blank" href="/store/privacy">rekisteriselosteen</a> ja hyväksyn ne.\n                </span>\n            </label>\n            <store-messages field="read_terms" :messages="messages" />\n        </div>\n    </div>\n    <div class="clearfix"></div>\n</form>\n'},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function a(t,e,n){return t.product.id===e.id&&(!n||t.variant&&n.id===t.variant.id)}var i=n(0),r=o(i),s=n(2);n(3);var u=[{id:1,name:"Paytrail verkkomaksu"},{id:0,name:"BitPay (maksa BitCoinilla)"}];r.default.filter("formatPrice",s.formatPrice),r.default.component("store-product",{template:n(5),props:{product:Object,cart:Array,messages:Object},data:function(){return{variant:null}},created:function(){var t=this.product;t.variants&&t.variants.length&&(this.variant=t.variants[0])},methods:{addItem:function(){this.$emit("addItem",this.product,this.variant)}},computed:{cartCount:function(){var t=this.product,e=this.variant;if(!this.cart)return 0;var n=this.cart.findIndex(function(n){return a(n,t,e)});return n<0?0:this.cart[n].count}}});new r.default({el:"#store",data:{products:[],cart:[],messages:{},loadingStatus:"loading",info:{first_name:"",last_name:"",email:"",street:"",postal_code:"",city:"",country:"",mobile:"",telephone:"",company:"",information:"",read_terms:!1},paymentMethod:1,totalPrice:0},template:n(4),created:function(){var t=this;(0,s.storeXHR)("GET","/api/store_items/?format=json").then(function(e){e.forEach(function(t){t.price=parseFloat(t.price)}),t.products=e,t.loadingStatus="done"}).catch(function(e){console.error("error fetching store items:",e),t.loadingStatus="error"})},computed:{paymentMethods:function(){return u}},methods:{updateInfo:function(t){this.info=t},getSubtotal:function(t){var e=1,n=t.product.discount_amount,o=(100-t.product.discount_percentage)/100;return n&&t.count>=n&&(e*=o),t.product.price*t.count*e},updateCart:function(){var t=this,e=0;this.cart.forEach(function(n){e+=t.getSubtotal(n)}),this.totalPrice=e},addItem:function(t,e){var n=this.cart.findIndex(function(n){return a(n,t,e)});if(n>=0){var o=Object.assign({},this.cart[n]);o.count++,this.cart.splice(n,1,o)}else this.cart.push({count:1,product:t,variant:e});this.updateCart()},removeItemFromCart:function(t){var e=this.cart.indexOf(t);this.cart.splice(e,1),this.updateCart()},changeItemCount:function(t,e){var n=this.cart.indexOf(t),o=this.cart[n];return o.count+e<=0?void this.removeItemFromCart(o):(o.count+=e,this.cart.splice(n,1,o),void this.updateCart())},getTransactionObject:function(){var t=Object.assign({},this.info);return t.items=this.cart.map(function(t){return{item_id:t.product.id,variant_id:t.variant?t.variant.id:null,amount:t.count}}),t.payment_method=this.paymentMethod,t},submit:function(){var t=this,e=this.info;if(e.email!==e.email2)return void(this.messages={email:["Kirjoita sama sähköpostiosoite kahdesti."],email2:["Kirjoita sama sähköpostiosoite kahdesti."]});var n=this.getTransactionObject();return n.save=!0,(0,s.storeXHR)("POST","/api/store_transaction/?format=json",n).then(function(t){console.info(t)},function(e){t.messages=e,e&&(e.email2=e.email)}).catch(function(t){console.error(t)})}}})}]);