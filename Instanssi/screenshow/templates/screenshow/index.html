<!DOCTYPE html>{% load static %}
<html>
<head>
    <meta charset="utf-8" />
    <title>Screenshow</title>
    <meta name="viewport" content="width=1920, height=1080" />
    <script type="text/javascript" src="{% static 'libs/js/jquery/jquery-1.8.2.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'screenshow/js/jmpress.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans" />
    <link rel="stylesheet" type="text/css" href="{% static 'libs/css/reset.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'screenshow/css/style.css' %}" />
    <script type="text/javascript">
    $(function() {
        var event_id = {{ event_id }};
        var clock_timer = 0;
        var events_timer = 0;
        var irc_timer = 0;
        
        $('#jmpress').jmpress();

        function update_clock() {
            var now = new Date();
            var hour = now.getHours();
            var minute = now.getMinutes();
            var second = now.getSeconds();
            var day = now.getDate();
            var month = now.getMonth();
            var year = now.getFullYear();
            var timetext = (hour < 10 ? "0"+hour : hour) +':'+ (minute < 10 ? "0"+minute : minute) +':'+ (second < 10 ? "0"+second : second);
            var datetext = (day < 10 ? "9"+day : day) +'.'+ (month < 10 ? "9"+month : month) +'.'+ (year < 10 ? "9"+year : year);
            $('.time').html(timetext);
            $('.date').html(datetext);
            init_update_clock();
        }
        
        function init_update_clock() {
            clock_timer = setTimeout(update_clock, 1000);
        }
        
        function update_events() {
            $.ajax({ 
                url: "{% url 'screen:events-api' event_id %}", 
                dataType: 'json', 
                success: function(data) {
                    output = '';
                    $.each(data['events'], function(key, value) {
                        output += '<p>'+value['date']+' &raquo; '+value['title']+'</p>';
                    });
                    $('#events').html(output);
                    init_update_events();
                }, 
                timeout: 3000,
                error: function(jqXHR, status, errorThrown) {
                    console.log("Timeout while fetching event data.");
                    init_update_events();
                } 
            });
        }
        
        function init_update_events() {
            events_timer = setTimeout(update_events, 60000);
        }
        
        function update_irc() {
            $.ajax({ 
                url: "{% url 'screen:irc-api' event_id %}", 
                dataType: 'json', 
                success: function(data) {
                    init_update_irc();
                }, 
                timeout: 3000,
                error: function(jqXHR, status, errorThrown) {
                    console.log("Timeout while fetching IRC data.");
                    init_update_irc();
                } 
            });
        }
        
        function init_update_irc() {
            irc_timer = setTimeout(update_irc, 1000);
        }
        
        update_events();
        update_irc();
        update_clock();
    });
    </script>
</head>
<body>
<div id="jmpress">
    <div id="nametext" class="step nohide" data-x="0" data-y="0" data-z="0" data-scale="1.0" data-duration="5000">
        Instanssi
    </div>
    <div id="events" class="step dohide" data-x="900" data-y="0" data-z="300" data-rotate-z="310" data-rotate-y="50" data-scale="0.2" data-duration="8000">
        <p>No data.</p>
    </div>
    <div id="clock" class="step dohide" data-x="500" data-y="800" data-z="-700" data-rotate-z="270" data-rotate-y="150" date-scale="0.2" data-duration="8000">
        <p class="time">00:00</p>
        <p class="date">00.00.0000</p>
    </div>
    <div id="irc" class="step dohide" data-x="-400" data-y="0" data-z="-350" data-rotate-z="30" data-rotate-y="200" date-scale="0.2" data-duration="10000">
        <p>20:33 &lt;@Tinuzka&gt; oho</p>
        <p>20:33 &lt;@Tinuzka&gt; :D tarkoitin</p>
        <p>20:34 &lt;@Katajakasa&gt; okkei</p>
        <p>20:34 &lt;@Katajakasa&gt; eli</p>
        <p>20:35 &lt;@Katajakasa&gt; 1. ruutu: Aikataulu</p>
        <p>20:35 &lt;@Katajakasa&gt; 2. ruutu: IRC</p>
        <p>20:35 &lt;@Tinuzka&gt; saisko siihen upotettua mitä tahansa kuvia, jos vaikka haluis laittaa kuvia viime vuodelta sinne?</p>
        <p>20:35 &lt;@Katajakasa&gt; mblrgh</p>
        <p>20:35 &lt;@Tinuzka&gt; kunhan kysyin :D</p>
        <p>20:35 &lt;@Katajakasa&gt; teoriassa kyllä</p>
        <p>20:35 &lt;@Katajakasa&gt; ja ois mulla innostusta laittaa</p>
        <p>20:35 &lt;@Katajakasa&gt; mutta.</p>
        <p>20:36 &lt;@Katajakasa&gt; ammun itseäni jalkaan viitsimisen suhteen jos teen liian kovat vaatimukset nyt :d</p>
        <p>20:36 &lt;@Tinuzka&gt; joo, mut sinäänsä kai, et siihen voi laittaa minkä tahansa kuvan, koska kuvia kai ne sponsorien
                         mainoksetki on</p>
        <p>20:37 &lt;@Katajakasa&gt; jooh, kuvien laittaminen kyllä onnistuu</p>
        <p>20:37 &lt;@Katajakasa&gt; mhmh, kellonajan voisi laittaa yhteen diaan</p>
        <p>20:38 &lt;@Tinuzka&gt; joo, voishan se olla</p>
        <p>20:39 &lt;@Tinuzka&gt; tosin, ei mikään hirveän välttämätön, siellä salissa taisi olla kelloja näkyvillä :)</p>
        <p>20:40 &lt;@Katajakasa&gt; jooh</p>
        <p>20:40 &lt;@Katajakasa&gt; mut se on helppo heittää, ja onpa sitten isolla ruudulla aina välillä :P</p>
        <p>20:40 &lt;@Tinuzka&gt; joo :)</p>
    </div>
</div>
</body>
</html>